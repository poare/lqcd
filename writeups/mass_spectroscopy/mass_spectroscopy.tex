\documentclass[11pt, oneside]{article}   	% use "amsart" instead of "article" for AMSLaTeX format
\usepackage[margin = 1in]{geometry}                		% See geometry.pdf to learn the layout options. There are lots.
\geometry{letterpaper}                   		% ... or a4paper or a5paper or ... 
%\geometry{landscape}                		% Activate for rotated page geometry
%\usepackage[parfill]{parskip}    		% Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}				% Use pdf, png, jpg, or epsÂ§ with pdflatex; use eps in DVI mode
								% TeX will automatically convert eps --> pdf in pdflatex		
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage[shortlabels]{enumitem}
\usepackage{float}
\usepackage{tikz-cd}

\usepackage{amsthm}
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}

\newcommand{\N}{\mathbb{N}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}

%SetFonts

%SetFonts


\title{Mass Spectroscopy}
\author{Patrick Oare}
\date{}							% Activate to display a given date or no date

\begin{document}
\maketitle

\section{Overview}

The idea of mass spectrometry is to use the lattice to calculate two point functions, and then to take these 
two point functions and extract physics. The central equation to this is the following:
\begin{equation}
	C(n_t) := \langle\mathcal O(n_t)\overline{\mathcal O}(0)\rangle = \sum_k\langle 0|\hat{\mathcal O} 
	|k\rangle\langle k|\hat{\mathcal O}^\dagger |0\rangle\exp\left(-n_t E_k\right)~
	\label{eq:two_point}
\end{equation}
Here $|k\rangle$ represents any intermediate state which can be connected to the operator $\mathcal O$ 
with energy $E_k$, and $n_t$ is the time slice we are calculating the correlation function on. The operators 
$\hat{\mathcal O}$ and $\hat{\mathcal O}^\dagger$ are related to the objects $\mathcal O$ and 
$\overline{\mathcal O}$ by the following identity:
\begin{equation}
	\mathcal O(\alpha)\delta(\alpha - \alpha') := \langle \alpha' | \hat{\mathcal O} | \alpha\rangle
\end{equation}
where $|\alpha\rangle$ is a continuous eigenbasis of the space you are considering. 

Using the relation between two point functions and matrix elements, we may extract physics about the energies 
of nucleon states. To do this, we consider evaluating two point functions when $\mathcal O$ is an 
\textbf{interpolator} for the state we want to analyze. By an interpolator, we mean that $\mathcal O$ 
creates or destroys the state of interest. For example, a proton interpolator $\chi(n)$ will destroy a proton at 
site $n$, and its adjoint $\overline\chi(n)$ will create a proton at site n. 

So, suppose that we want to calculate the mass of a hadron $h$ with corresponding interpolator $\chi$. 
Then using Equation~\ref{eq:two_point}, we have:
\begin{equation}
	\langle\chi(n_t)\overline\chi(0)\rangle = \sum_k\langle 0 |\hat\chi |k\rangle\langle k |
	\hat{\chi}^\dagger |0\rangle\exp(-n_t E_k)
\end{equation}
Because the operator $\hat{\chi}^\dagger$ creates a hadron state $\hat{\chi}^\dagger|0\rangle$, the 
sum over intermediate states $|k\rangle$ will only connect states with the quantum numbers of the hadron of 
interest to the ket $\hat{\chi}^\dagger|0\rangle$. So, the sum $\sum_k$ will only index over intermediate 
states which contain at least one hadron of species $h$. 

Consider taking the large $n_t$ limit of this equation. When $n_t$ gets large, intermediate states with a larger 
energy $E_k$ become exponentially suppressed, and the dominant term in this series is the state $|k\rangle$ 
with the lowest energy. Here is the key point: \textit{the lowest energy state is exactly the ground state, and the 
energy will be given (at zero momentum) by $E_0 = m_h$}. Thus, as we take $n_t$ to be larger and larger, 
we can extract the hadron mass $m_h$ by calculating the two point function of the interpolating operator:
\begin{equation}
	\langle\chi(n_t)\chi^\dagger(0)\rangle = A\exp(-n_t E_0)(1 + O(e^{-n_t\Delta E}))
\end{equation}
where now $A$ is a constant we can determine with a data fit. 

\subsection{Momentum Projection}

The state of the hadron we have created with the interpolator has not been completely specified; although we know 
it lies on a fixed timeslice, we do not know the momentum of the hadron. If we compute the corrlation function 
$\langle\chi(\textbf{n}, n_t)\chi^\dagger (0)\rangle$, we will know the location of the particle we have destroyed, 
but we will not know its momentum. We instead want to make sure that we project onto a state of definite 
momentum, which we will do with a Fourier transform:
\begin{equation}
	\langle\chi(\textbf p, n_t)\chi^\dagger(0)\rangle = \frac{1}{\sqrt{|\Lambda_3|}}\sum_{\textbf n\in\Lambda_3}e^{-ia
	\textbf{p}\cdot\textbf{n}}\langle\chi(\textbf n, n_t)\chi^\dagger(0)\rangle \xrightarrow{n_t\rightarrow\infty} 
	A\exp(-n_t E_0(\textbf p)) + ...
\end{equation}
where $\Lambda_3 = \{(\textbf{n}, n_t)\in\Lambda : \mathbf{n}\in\mathbb Z^3\}$ is the set of lattice points on our 
fixed time slice ($\Lambda$ is the full lattice). The important point here is that we know the dispersion $E(\mathbf p)$, 
which is simply:
\begin{equation}
	E(\mathbf p) = \sqrt{\textbf p^2 + m_h^2}
\end{equation}
In practice, we will often project onto $\textbf 0$ momentum, which is easily achievable through summing on spatial 
points in the lattice:
\begin{equation}
	\langle \chi(\textbf p = \textbf 0, n_t)\chi^\dagger(0)\rangle = \frac{1}{\sqrt{|\Lambda_3|}}\sum_{\textbf{n}
	\in\Lambda_3}\langle\chi(\textbf n, n_t)\chi^\dagger(0)\rangle\xrightarrow{n_t\rightarrow\infty} A\exp(-n_t m_h) + ...
\end{equation}

\subsection{Effective Mass}

In theory we would like to take the limit as $n_t\rightarrow\infty$ to remove contamination from the higher energy 
states, but on a finite lattice this is not possible. So, we need to define a way to know when $n_t$ is large enough 
that the energy we extract from this method is sufficiently close to the mass of the hadron. A simple way to do this 
is to define a mass scale by noticing that as $n_t\rightarrow\infty$, $C(n_t)\rightarrow Ae^{-n_t m_h}$. 
In this limit, we can extract the mass by taking a ratio of correlation functions:
\begin{equation}
	\frac{C(n_t)}{C(n_t + 1)}\xrightarrow{n_t\rightarrow\infty} e^{m_h}
\end{equation}
This motivates the definition of the \textbf{effective mass}:
\begin{equation}
	m_{eff}(n_t) := \log\left(\frac{C(n_t)}{C(n_t + 1)}\right)
\end{equation}
As $n_t$ becomes sufficiently large, $m_{eff}(n_t)$ approaches a constant an plateaus at the value $m_{eff} = m_h$. 
At smaller time slices, $m_{eff}(n_t)$ will not appear to be constant but instead will also contain contamination from 
higher energy modes. Thus in essence, it suffices to compute the effective mass and to fit a constant line to the 
region where it plateaus to determine the actual mass of the hadron. 

Because we often use periodic boundary conditions on the lattice, it is often useful to take this into account and 
define a variation of the effective mass, which is the \textbf{cosh-corrected effective mass}. Let $N_T$ be the temporal 
extent of the lattice. Then:
\begin{equation}
	\frac{C(n_t)}{C(n_t + 1)} = \frac{\cosh(m_{eff}(n_t - N_T / 2))}{\cosh(m_{eff}(n_t - N_T / 2+ 1))}
\end{equation}

\subsection{Bootstrapping}

Assume now that we have calculated values of the interpolation function on $n$ gauge field configurations 
$\{U_i\}_{i = 1}^n$, and that our lattice has size $L^3\times T$. Let the values of the interpolators be 
contained in the set:
\begin{equation}
	\{C(i, t)\}_{i = 1, t = 1}^{n, T}
\end{equation}
where $C(i, t)$ is the value of the interpolator on the $i$th gauge field configuration, momentum projected 
to 0 on the $t$th time slice. Generally these values $C(i, t)$ will be stored in a matrix $C_{it}$ to make them 
easier to work with. If we simply want to ensemble average of these interpolators, at this point we could 
average them over the configuration index to find:
\begin{equation}
	\langle C(t)\rangle = \frac{1}{n}\sum_{i = 1}^n C(i, t)
\end{equation}
This would give us an average for our correlation function computed at each time slice, which is what we 
originally sought after.

However, this is not the best way to establish statistics on this problem. Instead, we consider a method 
called \textbf{bootstrapping}, which will allow us to produce a larger amount of ensembles from our 
initial data $C(i, t)$. With this method, we consider generating $N_{boot}$ new ensembles from our 
original one. To do this, fix $t$ and pick $n$ entries from $C(i, t)$ randomly \textit{with replacement}. 
Denote these $n$ samples by $A_1(i, t)$. Repeat this sampling procedure $N_{boot}$ times until 
you have a collection $A_1(i, t), ..., A_{N_{boot}}(i, t)$ of ensembles sampled from your original data. 
We may use the notation $A(b, i, t)$ for $A_b(i, t)$, where $b = 1, ..., N_{boot}$, $j = 1, ..., n$, and $t = 
1, ..., T$ to refer to these ensembles and to emphasize its structure as a 3-dimensional matrix. 

The ensemble $\mathbb A := \{A_1, ..., A_{N_{boot}}\}$ will be used for our data analysis. Suppose that we are trying 
to compute the effective mass $m_{eff}$ from this set of data. For each dataset $A\in\mathbb A$ (recall this is a 
matrix of size $n\times T$), we can compute the values of the effective mass, denoted $m_A$, by the following:
\begin{equation}
	m_{A}(i, t) = \log\left(\frac{A(i, t)}{A(i, t + 1)}\right)
\end{equation}
At this point, we may average $m_{A}(i, t)$ over each gauge field configuration in $A$ to get an estimate on its mean:
\begin{equation}
	\hat{m}_A(t) = \frac{1}{n}\sum_{i = 1}^n m_A(i, t)
\end{equation}
For each time slice $t$, we use the set $\{\hat{m})A(t) : A\in\mathbb A\}$ to perform an estimate of the effective mass 
and its error (note $N_{boot} = |\mathbb A|$):
\begin{equation}
	\mu_{m}(t) = \frac{1}{|\mathbb A|}\sum_{A\in\mathbb A}\hat{m}_A(t)
\end{equation}
\begin{equation}
	\sigma_m(t)^2 = \frac{1}{|\mathbb A| - 1}\sum(\hat m_A(t) - \mu_m(t))^2
\end{equation}

Using the bootstrap method, we may calculate statistics on functions other than just the effective mass. Particular 
quantities of importance to calculate other than the effective mass are the value of the correlation function and the 
cosh-corrected effective mass. To calculate other quantities (say a quantity $X$ which depends on $C(i, t)$), simply 
compute this quantity $X_A(i, t)$ for each ensemble $A\in\mathbb A$ as we did for $m_A(i, t)$ and follow the rest of 
the calculation precisely. 

\newpage
\section{Example: Pion Mass}

We will be computing the mass of the pion $\pi^+$ in this example.

\subsection{Pion interpolator}

The $\pi^+$ interpolator (which can be checked by observing its transformation properties under symmetries like parity 
and charge conjugation) is:
\begin{equation}
	\chi_\pi(n) = \overline d(n)\gamma^5 u(n)
\end{equation}

To perform computations with this on the lattice, we can work out an expression for the fermionic part of the 
two-point function for this interpolator:
$$
	\langle\chi_\pi(n)\overline\chi_\pi(m)\rangle_F = \left\langle \left(\overline d(n)_\alpha^a \gamma^5_{\alpha\beta} 
	u(n)_\beta^a\right)\left(\overline u(m)_\rho^b\gamma^5_{\rho\sigma} d(m)_\sigma^b\right)\right\rangle_F
$$
$$
	= -\gamma^5_{\alpha\beta}\gamma^5_{\rho\sigma}\left\langle u(n)_\beta^a \overline u(m)_\rho^b\right\rangle_F
	\left\langle d(m)_\sigma^b\overline d(n)_\alpha^a\right\rangle_F
$$
$$
	= -\gamma_{\alpha\beta}^5\gamma_{\rho\sigma}^5 D^{-1}_u(n | m)_{\beta\rho}^{ab} D^{-1}_d (m | n)_{\sigma\alpha}^{ba}
$$
$$
	= -tr\left\{\gamma^5 D^{-1}_u (n | m) \gamma^5 D^{-1}_d (m | n)\right\}
$$
where we picked up a $-$ sign because the fields are Grassmannian. Note we use Wick's 
theorem to turn the products $\langle u \overline u\rangle$ and $\langle d\overline d\rangle$ of fermion fields into propagators 
$D^{-1}_u$ and $D^{-1}_d$. However, this current expression requires computing a fermion propagator at the source $m$ and 
tying it up at $n$, and doing the same with creating a source at $n$ and tying it up at $m$. To simplify this further, we 
exploit $\gamma^5$-hermicity of the propagator:
\begin{equation}
	D^{-1}(m | n) = \gamma^5 D^{-1}(n | m)^\dagger\gamma^5
\end{equation}
where the $\dagger$ is taken in Dirac space. Hence we have the final form for this equation which we will use:
\begin{equation}
	\langle\chi_\pi(n)\overline\chi_\pi(m)\rangle_F = - tr\left\{D^{-1}_u (n | m) D^{-1}_d (n | m)^\dagger\right\}~
	\label{eq:correlator}
\end{equation}

In particular, to compute the $\pi^+$ mass we will put a source at the origin and project it onto $\textbf 0$ momentum 
on time slice $n_t$. This is (where $|\Lambda_3|$ is the size of the spatial lattice):
\begin{equation}
	C(n_t) := \left\langle \chi_\pi(\textbf p = \textbf 0, n_t)\overline\chi_\pi (0)\right\rangle_F = \frac{1}{\sqrt{
	|\Lambda_3|}}\sum_{\mathbf n\in\Lambda_3}\langle \chi_\pi(\textbf n, n_t)\overline\chi_\pi(0)\rangle_F
\end{equation}
or explicitly:
\begin{equation}
	C(n_t) = -\frac{1}{\sqrt{|\Lambda_3|}}\sum_{\textbf n\in\Lambda_3} tr\left\{ D^{-1}_u (\textbf n, n_t \,|\, 0) D^{-1}_d 
	(\textbf n, n_t \,|\,0)^\dagger\right\}~
	\label{eq:zero_projection}
\end{equation}

\newpage
\subsection{Code}

The code I wrote to compute the pion mass does the following steps. Suppose that a set of gauge field 
configurations $\mathcal U = \{U_i\}_{i = 1}^N$ is given. In my case, I used the configurations in 
/data/d10b/ensembles/ isoClover/cl3\_16\_48\_b6p1\_m0p2450, where there were 254 configurations (although one 
configuration was not loading in, so I used $N = 253$ configurations). I begin by initializing the following parameters:
\begin{itemize}
	\item A lattice $L$ of size $16^3\times 48$. 
	\item The parameter $\beta = 6.1$.
	\item Quark masses $m = m_u = m_d = .2450$.
	\item The hopping parameter $\kappa = \frac{1}{2m + 8}$. I checked and am not positive how to specify the 
	mass parameter in the clover inverter instead of the $\kappa$ value, so I decided to just compute this from the 
	masses and put it directly into the inverter. 
	\item The spatial volume of the lattice $V = 16^3$.
\end{itemize}

Once these paramters are specified, I loop over each gauge field configuration $U\in\mathcal U$ and do the following:
\begin{enumerate}
	\item Create clover objects $CL_u$ and $CL_d$ for the up and down quarks. I initialize these objects with:
	\begin{itemize}
    		\item Periodic boundary conditions in space and antiperiodic boundary conditions in time
		\item Hopping parameters $\kappa_u = \kappa_d = \kappa$ which were specified above. 
		\item Sheikholeslami-Wohlert coefficients of $c_{sw} = 1$. 
	\end{itemize}
	\item Initialize a source at the origin, which is the identity in Dirac space and color space. 
	\item Using this source, I use the clover objects to solve for the up and down quark propagators $D^{-1}_u(n, 0)$ 
	and $D^{-1}_d(n, 0)$. Some of my parameters on this solver are a bit weird, and I'm running a few tests to see if 
	these have any impact on the result now.
	\item Compute the correlation function $\langle\chi_\pi(n)\overline\chi_\pi(0)\rangle_F$ in 
	Equation~\ref{eq:correlator} with $m = 0$ by multiplying $D^{-1}_u(n, 0)$ with $D^{-1}_d(n, 0)^\dagger$ at each 
	lattice point and taking traces in Dirac and color space. 
	\item For each time slice $n_t$, project these correlators onto zero momentum with 
	Equation~\ref{eq:zero_projection}. This is done by summing 
	$\langle\chi_\pi (\mathbf n, n_t)\overline\chi_\pi (0)\rangle_F$ over all spatial points $\textbf n\in\Lambda_3$ and 
	normalizing this sum by $1 / \sqrt{|\Lambda_3|}$. 
	\item Write $C(n_t)$ to a line in an output file to save for data analysis later. 
\end{enumerate}

The output of this program is a file containing the value $C(n_t)$ for each gauge field configuration $U\in\mathcal U$. 

\end{document}